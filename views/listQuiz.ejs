<% include ./layout/header %>
<% include ./modal/addNewQuestion %>
<div class="container ListQuiz">
    <div class="row justify-content-between align-items-center">
        <div class="row Subject flex-column">
            <div class="SubjectTile">
                <strong>Môn học:</strong> <%= subject.name %></strong>
                <input type="hidden" id="subjectId" data-slug="<%=subject.slug %>" value="<%=subject.id %>">
            </div>
            <div class="SubjectInfo">
                <ul class="list">
                    <li>Tổng: <%=numQuestion.num %> câu</li>
                    <li>Câu dễ: <%=numQuestion.numE %> câu</li>
                    <li>Câu trung bình: <%=numQuestion.numM %> câu</li>
                    <li>Câu khó: <%=numQuestion.numH %> câu</li>
                </ul>
            </div>
        </div>
        <div>
            <a href="#" class="btn btn-sm btn-dark"> Chỉnh sửa</a>
            <a href="#" class="btn btn-sm btn-success ml-2" id="btnAddNewQuestion"> Thêm câu hỏi</a>
        </div>
    </div>
    <div class="ListQuiz__content">
        <ul class="list-group list-group-flush">
            <% if(questions.length > 0) { %>
            <%  questions.forEach(function(quiz, i) { %>
                <li class="list-group-item quiz">
                    <div class="QuizItem">
                        <div class="quiz__content">
                            <h6 class="font-weight-bold">
                                Câu <%=i + 1 %>.<%=quiz.content %>
                            </h6>
                            <ul>
                                <li
                                    <% if(quiz.answers[0].isTrue) {%>
                                        class="text-danger"
                                    <% }%>
                                >
                                    A. <%=quiz.answers[0].content%>
                                </li>
                                <li
                                    <% if(quiz.answers[1].isTrue) {%>
                                        class="text-danger"
                                    <% }%>
                                >
                                    B. <%=quiz.answers[1].content%>
                                </li>
                                <li
                                    <% if(quiz.answers[2].isTrue) {%>
                                        class="text-danger"
                                    <% }%>
                                >
                                    C. <%=quiz.answers[2].content%>
                                </li>
                                <li
                                    <% if(quiz.answers[3].isTrue) {%>
                                        class="text-danger"
                                    <% }%>
                                >
                                    D. <%=quiz.answers[3].content%>
                                </li>
                            </ul>
                        </div>
                        <div class="quiz__option">
                            <a href="#" class="btn btn-sm"> Chỉnh sửa</a>
                            <a href="#" class="btn btn-sm btn-danger"> Xóa</a>
                        </div>
                    </div>
                </li>
            <% });
            } else {%>
                <p class="alert alert-danger">Không có câu hỏi nào.</p>
            <%}%>
            
    </div>
</div>
<script>
    $('input[name="indexResult"]').on('change', function(){
        $('input[name="indexResult"]').prop('checked', false);
        $(this).prop('checked', true);
    })

    $('#btnAddNewQuestion').click(function(){
        $('#FormNewQuestion').trigger('reset');
        $('#modalAddNewQuestion').modal('show');
    })

    $('#btnSaveNewQuestion').click(function(){
        const subjectSlug = $('#subjectId').attr('data-slug');
        const url = `/${subjectSlug}/create`;
        const data = $('#FormNewQuestion').serializeArray();
        let dataObj = handleSerializeArrayToObj(data);
        dataObj.subjectId = $('#subjectId').val();
        dataObj.subjectSlug = subjectSlug;
        const options = {   
            method: 'POST',
            url: url,
            data: dataObj,
            success: function(res){
                console.log(res);
            },
            error: function(err){
                console.log(err.message);
            }
        };
        $.ajax(options);
    })
</script>
<% include ./layout/footer %>